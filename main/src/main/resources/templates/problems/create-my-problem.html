<!doctype html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html class="h-100" lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
  <meta name="description" content="A growing collection of ready to use components for the CSS framework Bootstrap 5">
  <meta name="author" content="Holger Koenemann">
  <meta name="generator" content="Eleventy v2.0.0">
  <meta name="HandheldFriendly" content="true">
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
  <meta name="groupId" th:content="${groupId}"/>

  <title>CODEVIEWER</title>
  <link rel="stylesheet" type="text/css" th:href="@{/static/css/theme.min.css}">

  <style>

    /* inter-300 - latin */
    @font-face {
      font-family: 'Inter';
      font-style: normal;
      font-weight: 300;
      font-display: swap;
      src: local(''),
      url('/static/fonts/inter-v12-latin-300.woff2') format('woff2'), /* Chrome 26+, Opera 23+, Firefox 39+ */
      url('/static/fonts/inter-v12-latin-300.woff') format('woff'); /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
    }

    @font-face {
      font-family: 'Inter';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: local(''),
      url('/static/fonts/inter-v12-latin-500.woff2') format('woff2'), /* Chrome 26+, Opera 23+, Firefox 39+ */
      url('/static/fonts/inter-v12-latin-500.woff') format('woff'); /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
    }
    @font-face {
      font-family: 'Inter';
      font-style: normal;
      font-weight: 700;
      font-display: swap;
      src: local(''),
      url('/static/fonts/inter-v12-latin-700.woff2') format('woff2'), /* Chrome 26+, Opera 23+, Firefox 39+ */
      url('/static/fonts/inter-v12-latin-700.woff') format('woff'); /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
    }

  </style>

</head>

<body class="d-flex h-100 w-100" data-bs-spy="scroll" data-bs-target="#navScroll">

<div class="h-100 container-fluid">
  <div class="h-100 row d-flex align-items-stretch">

    <div class="col-12 col-md-7 col-lg-6 d-flex align-items-start flex-column px-vw-5">

      <header class="mb-auto py-vh-2 col-12">
        <a class="navbar-brand pe-4 fs-4" href="/">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-layers-half" viewbox="0 0 16 16">
            <path d="M8.235 1.559a.5.5 0 0 0-.47 0l-7.5 4a.5.5 0 0 0 0 .882L3.188 8 .264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l2.922-1.559a.5.5 0 0 0 0-.882l-7.5-4zM8 9.433 1.562 6 8 2.567 14.438 6 8 9.433z"/>
          </svg>
          <span class="ms-1 fw-bolder">IISE</span>
        </a>

      </header>

      <main class="mb-auto col-12">

        <h1>문제 생성</h1>
        <div sec:authorize="isAuthenticated()">
          <form id="problemCreateForm" class="row" method="post" enctype="multipart/form-data">
            <!--            <input type="hidden" th:field="*{id}" />-->
            <div class="col-12 col-lg-10 col-xl-8">

              <div class="mb-3">
                <label class="form-label">문제명
                <input type="text" value="" name="name" class="form-control form-control-lg" placeholder="문제명은 필수입니다.">
                </label>
              </div>

              <div class="mb-3">
                <label class="form-label">오픈 시간
                  <input type="text" value="" name="openTime" class="form-control form-control-lg" placeholder="오픈 시간">
                </label>
              </div>

              <div class="mb-3">
                <label class="form-label">마감 시간
                  <input type="text" value="" name="closedTime" class="form-control form-control-lg" placeholder="마감 시간">
                </label>
              </div>



              <div class="mb-3" id="addDescriptionForm">
                <label class="form-label">문제 설명
                <input type="text" class="form-control form-control-lg" name="descriptions">
                </label>
              </div>
              <a id="addDescriptionParam" href="javascript:void(0);">문제 설명 추가</a>

              <div class="mb-3" id="addSampleForm">
                <label class="form-label">인풋
                  <input type="text" class="form-control form-control-lg" name="inputs">
                </label>
                <label class="form-label">아웃풋
                  <input type="text" class="form-control form-control-lg" name="outputs">
                </label>
              </div>
              <a id="addSampleParam" href="javascript:void(0);">샘플 추가</a>


              <div class="mb-3">
                <label class="form-label">문제 파일 업로드
                  <input type="file" class="form-control form-control-lg" name="problemFile" id="problemFile">
                </label>
              </div>
              </div>

              <div class="mb-3">
                <label class="form-label">쉘 파일 업로드
                  <input type="file" class="form-control form-control-lg" name="shellFile" id="shellFile">
                </label>
              </div>

              <div class="mb-3">
                <label class="form-label">인풋 파일 업로드
                  <input type="file" class="form-control form-control-lg" name="inputFile" id="inputFile">
                </label>
              </div>

            <button type="button" id="ajaxProblemCall" onclick="ajaxCall()" class="btn btn-primary btn-xl">등록</button>
          </form>
        </div>
      </main>
    </div>


  </div>
  <footer>
  </footer>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script>

    $(document).ready(function() {
      $('#addDescriptionParam').click(function() {
        const html = '<br/>  ' +
                '<label class="form-label">문제 설명\n' +
                '<input type="text" class="form-control form-control-lg" name="descriptions">\n' +
                '</label>'

        $('#addDescriptionForm').append(html);
      });
    });

    $(document).ready(function() {
      $('#addSampleParam').click(function() {
        const html = '<br/>                 ' +
                '<label class="form-label">인풋\n' +
                '<input type="text" class="form-control form-control-lg" name="inputs">\n' +
                '</label>\n' +
                '<label class="form-label">아웃풋\n' +
                '<input type="text" class="form-control form-control-lg" name="outputs">\n' +
                '</label>'
        $('#addSampleForm').append(html);
      });
    });


    function ajaxCall() {
      const token = $("meta[name='_csrf']").attr("content");
      const header = $("meta[name='_csrf_header']").attr("content");

      const groupId = $("meta[name='groupId']").attr("content");

      const form = $("#problemCreateForm")[0];

      const formData = new FormData(form);

      console.log(formData);

      $.ajax({
        type: 'POST',
        contentType: false,
        processData: false,
        cache: false,
        enctype : 'multipart/form-data',
        url: '/api/v1/groups/admin/' + groupId + '/problems/new',
        data: formData,
        beforeSend: function(xhr) {
          xhr.setRequestHeader(header, token);
        },
        async: true,
        cache: true,
        success: function(data) {
          location.href = "/api/v1/groups/admin/" + groupId;
        },

        error: function(xhr, status, error) {
          console.log('error:' + error);
          console.log('status:' + status);
          console.log('compile.error');
        }
      })
    }


    jQuery.fn.serializeObject = function() {
      let obj = null;
      try {
        if (this[0].tagName && this[0].tagName.toUpperCase() == "FORM") {
          const arr = this.serializeArray();
          if (arr) {
            obj = {};
            jQuery.each(arr, function() {

              if (this.name === "descriptions" || this.name === "inputs" || this.name === "outputs") {

                if (typeof obj[this.name] != "object") {
                  if (obj[this.name] == null) {
                    obj[this.name] = []
                  }
                }
                obj[this.name].push(this.value)

              } else {
                obj[this.name] = this.value
              }

            });
          }//if ( arr ) {
        }
      } catch (e) {
        alert(e.message);
      } finally {
      }

      return obj;
    };




  </script>

</div></body>
</html>
