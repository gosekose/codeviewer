<!doctype html>
<html class="h-100" lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <meta name="description" content="A growing collection of ready to use components for the CSS framework Bootstrap 5">
    <meta name="author" content="Holger Koenemann">
    <meta name="generator" content="Eleventy v2.0.0">
    <meta name="HandheldFriendly" content="true">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta name="memberId" th:content="${memberId}"/>

    <title>CODEVIEWER</title>
    <link rel="stylesheet" th:href="@{/static/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/static/css/theme.min.css}">
    <link rel="stylesheet" th:href="@{/static/css/webfont.css}">

    <style>
    </style>

</head>

<body data-bs-spy="scroll" data-bs-target="#navScroll">

<nav id="navScroll" class="navbar navbar-expand-lg navbar-light fixed-top" tabindex="0">
    <div class="container">
        <a class="navbar-brand pe-4 fs-4" href="/">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-layers-half"
                 viewbox="0 0 16 16">
                <path
                        d="M8.235 1.559a.5.5 0 0 0-.47 0l-7.5 4a.5.5 0 0 0 0 .882L3.188 8 .264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l2.922-1.559a.5.5 0 0 0 0-.882l-7.5-4zM8 9.433 1.562 6 8 2.567 14.438 6 8 9.433z" />
            </svg>
            <span class="ms-1 fw-bolder">IISE</span>
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <a class="nav-link" th:href="@{/api/v1/members/profile}">
                        마이 페이지
                    </a>
                </li>
                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <a class="nav-link" th:href="@{/logout}">
                        채널 관리
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#gallery" aria-label="Brings you to the frontpage">
                        서비스 소개
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        제휴 고객사
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        이용문의
                    </a>
                </li>
                <li class="nav-item" sec:authorize="isAuthenticated()">
                    <a class="nav-link" th:href="@{/logout}">
                        로그아웃
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div sec:authorize="isAuthenticated()" hidden>

    </div>
</nav>

<main>
    <div class="w-100 overflow-hidden bg-gray-100" id="top">

        <div class="container position-relative">
            <div class="col-12 col-lg-8 mt-0 h-100 position-absolute top-0 end-0 bg-cover" data-aos="fade-left"
                 style="background-image: url(/static/img/webp/interior11.webp);">

            </div>
            <div class="row">

                <div class="col-lg-7 py-vh-6 position-relative" data-aos="fade-right">
                    <h1 class="display-1 fw-bold mt-5">코드뷰어</h1>
                </div>

            </div>
        </div>
    </div>

</main>

<main>
    <div class="container py-vh-6">
        <div>
            <button type="button" class="btn btn-outline-dark">전체 그룹</button>
            <button type="button" class="btn btn-outline-dark">가입한 그룹</button>
            <button type="button" class="btn btn-outline-dark">미가입 그룹</button>
        </div>
        <table class="table">
            <thead>
            <tr>
                <th>그룹 번호</th>
                <th>그룹명</th>
                <th>공개 여부</th>
                <th>최대 멤버</th>
                <th>가입 신청 마감 시간</th>
                <td></td>
                <td></td>
            </tr>
            </thead>
            <tr th:each="group: ${memberGroups.getContent()}">
                <td th:text="${group.id}"></td>
                <td th:text="${group.name}"></td>
                <td th:text="${group.visibility}"></td>
                <td th:text="${group.maxMember}"></td>
                <td th:text="${group.joinClosedTime}"></td>
<!--                <td>-->
<!--                    <a href="#" th:href="@{/api/v1/groups/{id}/join (id=${group.id})}"-->
<!--                       class="btn btn-primary" role="button">그룹 가입 신청</a>-->
<!--                </td>-->
                <td>
                    <button type="button" onclick="groupJoin(this)" class="btn btn-primary"
                            data-toggle="modal" data-target="#joinModal" th:value="${group.id}">그룹 가입 신청</button>
                </td>
<!--                <td>-->
<!--                    <a href="#" th:href="@{/api/v1/groups/admin/edit/{id} (id=${group.id})}"-->
<!--                       class="btn btn-primary" role="button">그룹 수정</a>-->
<!--                </td>-->
            </tr>
        </table>


        <!-- Modal -->
        <div class="modal fade" id="joinModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        ...
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <nav style="text-align: center;">
            <ul class="pagination">

            </ul>
        </nav>

    </div>
</main>




<footer>
    <div class="container small border-top">
        <div class="row py-5 d-flex justify-content-between">

            <div class="col-12 col-lg-6 col-xl-3 border-end p-5">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-layers-half"
                     viewbox="0 0 16 16">
                    <path
                            d="M8.235 1.559a.5.5 0 0 0-.47 0l-7.5 4a.5.5 0 0 0 0 .882L3.188 8 .264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l2.922-1.559a.5.5 0 0 0 0-.882l-7.5-4zM8 9.433 1.562 6 8 2.567 14.438 6 8 9.433z" />
                </svg>
                <address class="text-secondary mt-3">
                    <strong>IISE, Inc.</strong><br>
                    서울과학기술대학교, IISE<br>
                    <abbr title="Phone"></abbr>
                    (02) 970-****
                </address>
            </div>
            <div class="col-12 col-lg-6 col-xl-3 border-end p-5">
                <h3 class="h6 mb-3">University</h3>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link link-secondary ps-0" aria-current="page" href="#">Seoultech IISE</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link link-secondary ps-0" href="#">Student, Seyun Ko</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link link-secondary ps-0" href="#">Professor, Sangheum Hwang</a>
                    </li>
                </ul>
            </div>
            <div class="col-12 col-lg-6 col-xl-3 border-end p-5">
                <h3 class="h6 mb-3">Products</h3>
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link link-secondary ps-0" aria-current="page" href="#">Fusce dapibus est</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link link-secondary ps-0" href="#">Donec sed dui</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link link-secondary ps-0" href="#">Tortor mauris</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link link-secondary ps-0" href="#">Ut fermentum massa</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link link-secondary ps-0" href="#">Magna mollis</a>
                    </li>
                </ul>
            </div>
            <div class="col-12 col-lg-6 col-xl-3 p-5">
                <h3 class="h6 mb-3">Subpages</h3>
                <ul class="nav flex-column">
                    <li class="nav-item">
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

<script th:src="@{/static/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/static/js/aos.js}"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script>
    AOS.init({
        duration: 800, // values from 0 to 3000, with step 50ms
    });

    function groupJoin(arg) {

        const token = $("meta[name='_csrf']").attr("content");
        const header = $("meta[name='_csrf_header']").attr("content");

        const groupId = $(arg).val();
        const memberId = $("meta[name='memberId']").attr("content");

        const jsonData = {
            "groupId" : groupId,
            "memberId" : memberId
        }


        $.ajax({
            type: 'POST',
            contentType: 'application/json',
            url: '/api/v1/groups/' + groupId + '/join',
            beforeSend: function(xhr) {
                xhr.setRequestHeader(header, token);
            },
            data: JSON.stringify(jsonData),
            async: true,
            cache: true,
            success: function(data) {
                console.log("success");
                console.log(data);

                if (data == true) {
                    alert("신청이 완료 되었습니다.");
                } else {
                    alert("이미 신청이 완료 되었습니다.");
                }
            },

            error: function(xhr, status, error) {
                console.log('error:' + error);
                console.log('status:' + status);
                console.log('compile.error');
            }
        })
    }


    $('#joinModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) // Button that triggered the modal
        var recipient = button.data('whatever') // Extract info from data-* attributes
        // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
        // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
        var modal = $(this)
        modal.find('.modal-title').text('New message to ' + recipient)
        modal.find('.modal-body input').val(recipient)
    })

</script>


</body>

</html>